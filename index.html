<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrepoBot Pro - Automatizaci√≥n de √âlite</title>
    <!-- PayPal SDK: SIEMPRE primero -->
    <script src="https://www.paypal.com/sdk/js?client-id=ARI8xtvx-zlykSa7RFIka_g5C3_iF8-CaK_ipoT_L9C_mDJiuUyTgTv_HLLHeXNPHrlwRQbmcPmYWIGs&currency=USD"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #151515; color: #e0e0e0; margin: 0;}
        .logo { font-size: 32px; color: #4caf50; margin-top:24px; margin-bottom:4px;}
        .nav { background: #222; padding: 15px; text-align: right;}
        .nav a, .nav button { color: #4caf50; background: none; border: none; padding:10px 18px; font-size: 16px; cursor:pointer;}
        .hero { text-align: center; margin-top: 50px;}
        .cta-button { background: #4caf50; color: #fff; padding: 12px 28px; border: none; border-radius: 5px; font-size: 20px; cursor:pointer;}
        .manual, .gallery-section { max-width: 800px; margin:32px auto; padding:18px; background: #222; border-radius:8px;}
        .gallery-section { display: flex; gap:24px; justify-content:center;}
        .gallery-item img { width:280px;border-radius:8px;border:2px solid #333;}
        .panel { max-width: 420px; margin: 32px auto; background: #222; padding: 26px; border-radius:8px; }
        .input-group { margin-bottom: 14px;}
        .input-group label { display: block; margin-bottom:3px;}
        .input-group input { border: 1px solid #444; border-radius:4px; background: #222; color: #fff; width: 100%; padding:7px; }
        .alert { padding:10px; border-radius:5px; margin-bottom:14px; font-size:15px;}
        .alert.error { background: #ffdddd; color: #d00;}
        .alert.success { background: #e6ffe6; color: #18831b;}
        .section { margin-bottom:24px;}
        .chat-widget { position: fixed; bottom: 20px; right: 20px; z-index: 9999;}
        .chat-btn { background: #4caf50; width: 55px; height: 55px; border-radius: 50%; border: none; cursor: pointer; font-size: 30px; color: white;}
        .chat-window { display: none; position: absolute; bottom: 65px; right: 0; width: 340px; height: 440px; background: #232326; border: 1px solid #333; border-radius: 10px; box-shadow: 0 10px 40px #000;}
        .chat-header { background: #252525; padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .chat-header h3 { margin:0;}
        .chat-input-area { padding:10px; background:#222; display:flex; gap:6px;}
        .chat-input-area input { flex:1; border-radius:18px; border:1px solid #555; padding:7px;}
        .chat-input-area button { background: #4caf50; border:none; color:white; font-size:17px; border-radius:15px; padding:0 16px;}
        .chat-body { flex:1; padding:10px; overflow-y:auto; display: flex; flex-direction: column; gap:7px;}
        .msg { padding: 7px 14px; border-radius:14px; max-width: 80%; font-size: 14px;}
        .msg.bot { background: #444; align-self:flex-start;}
        .msg.user { background: #4caf50; color: white; align-self:flex-end;}
        footer { text-align:center;padding:24px;color:#888;font-size:14px;}
        @media(max-width:530px) {.gallery-section{flex-direction:column;}}
    </style>
</head>
<body>

<div class="logo">‚öîÔ∏è GrepoBot Pro</div>
<div class="nav">
    <button onclick="document.getElementById('panel').scrollIntoView({behavior:'smooth'})">Portal</button>
    <a href="#manual">Manual</a>
    <a href="#gallery">Galer√≠a</a>
</div>
<div class="hero">
    <h1>Domina Grepolis <span style="color:#4caf50">autom√°ticamente</span></h1>
    <p>El bot m√°s avanzado para Grepolis: planificaci√≥n, ataques perfectos, y soporte IA.</p>
    <button class="cta-button" onclick="document.getElementById('panel').scrollIntoView({behavior:'smooth'})">PRUEBA DE 7 D√çAS</button>
</div>
<div class="manual section" id="manual">
    <h2>Manual R√°pido</h2>
    <ul>
        <li>Instala <b>Tampermonkey</b> en tu navegador</li>
        <li>Reg√≠strate abajo y paga o usa el trial gratuito</li>
        <li>Pulsa ‚ÄúINSTALAR BOT‚Äù en el panel de usuario</li>
    </ul>
    <ul>
        <li>Para atacar: abre la ventana de ataque, pon la hora y pulsa ‚ÄúCapturar‚Äù e ‚ÄúIniciar‚Äù</li>
        <li>Renueva licencia abajo: el pago es autom√°tico por PayPal</li>
    </ul>
</div>
<div class="gallery-section section" id="gallery">
    <div class="gallery-item">
        <img src="bot1.jpg" alt="bot planner">
        <p>Planner Preciso</p>
    </div>
    <div class="gallery-item">
        <img src="bot2.jpg" alt="menu bot">
        <p>Men√∫ Completo</p>
    </div>
</div>
<div class="panel section" id="panel">
    <h2>Portal de Usuario</h2>
    <div id="login-form">
        <div class="input-group"><label>Usuario</label>
        <input type="text" id="user" placeholder="Usuario"></div>
        <div class="input-group"><label>Contrase√±a</label>
        <input type="password" id="pass" placeholder="Contrase√±a"></div>
        <button class="cta-button" style="width:100%;" onclick="acceder()">Entrar / Registrar</button>
        <div id="msg-login" class="alert"></div>
    </div>
    <div id="dashboard" style="display:none;">
        <h3 id="user-display" style="color:#4caf50;"></h3>
        <div id="status-licencia" class="alert success" style="margin-bottom:20px;">Cargando...</div>
        <div style="background:#252525; padding:10px; border-radius:6px; margin-bottom:17px;">
            <h4>Instalaci√≥n</h4>
            <p>Instalar script en Tampermonkey</p>
            <button class="cta-button" style="width:100%;" id="btn-descargar" onclick="descargarArchivo()">üì• INSTALAR BOT</button>
            <div id="msg-descarga" style="margin-top:8px;font-size:13px;"></div>
        </div>
        <div style="background:#252525; padding:10px; border-radius:6px; margin-bottom:6px;">
            <h4>Renovar Licencia</h4>
            <div id="paypal-button-container"></div>
        </div>
    </div>
</div>
<!-- Chatbot Soporte IA -->
<div class="chat-widget">
    <button class="chat-btn" onclick="toggleChat()">ü§ñ</button>
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <h3>Soporte IA GrepoBot</h3>
            <span style="cursor:pointer;" onclick="toggleChat()">‚úñ</span>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="msg bot">Hola üëã Soy la IA de soporte. ¬øEn qu√© puedo ayudarte?<br><br>
            Ejemplos:<br>- "No me funciona"<br>- "¬øC√≥mo pagar?"<br>- "Instalar"</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Escribe tu duda..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()">‚û§</button>
        </div>
    </div>
</div>
<footer>
    ¬© 2026 GrepoBot Team. Software educativo.
</footer>
<script>
    // API seguro, solo para Render
    const API = 'https://grepobot-web.onrender.com/api';
    let currentUserId = null, selectedPlanId = '1_MES';
    function acceder() {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;
        const msg = document.getElementById('msg-login');
        msg.style.display = "none";
        if(!u || !p){msg.textContent="‚ö†Ô∏è Faltan datos"; msg.className="alert error";msg.style.display='block';return;}
        fetch(API+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})})
        .then(res=>res.json()).then(data=>{
            if(!data.success){
                fetch(API+'/registro',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})})
                .then(res=>res.json()).then(data2=>{
                    procesarLogin(data2,u,msg);
                });
            }else{
                procesarLogin(data,u,msg);
            }
        });
    }
    function procesarLogin(data,u,msg){
        if(data.success){
            currentUserId = data.usuarioId;
            document.getElementById('login-form').style.display='none';
            document.getElementById('dashboard').style.display='block';
            document.getElementById('user-display').textContent = "Hola, " + (data.username || u);
            if(data.dias<=0){
                statusLic("‚õî LICENCIA CADUCADA<br>Renueva abajo para continuar.","error");
            }else{
                statusLic("‚úÖ Licencia activa: "+data.dias+" d√≠as","success");
            }
            const btnDescargar = document.getElementById('btn-descargar');
            if(data.yaDescargo){
                btnDescargar.disabled=true;
                btnDescargar.style.opacity="0.5";
                document.getElementById('msg-descarga').innerHTML ='‚ùå Ya descargaste el bot. Renueva para descargar de nuevo';
            }else{
                btnDescargar.disabled = false;
                btnDescargar.style.opacity = "";
                document.getElementById('msg-descarga').innerHTML = '‚úÖ Descarga disponible';
            }
            renderPayPalButtons();
        }else{
            msg.textContent = data.error || "Error"; msg.className="alert error";msg.style.display='block';
        }
    }
    function statusLic(txt,type){
        const node = document.getElementById('status-licencia');
        node.textContent = ""; node.className="alert "+type; node.innerHTML = txt; node.style.display = "block";
    }
    function descargarArchivo(){
        if(!currentUserId)return alert("Sesi√≥n expirada");
        window.open(API + '/descargar/' + currentUserId + '/GrepoBot.user.js', "_blank");
    }
    function renderPayPalButtons(){
        document.getElementById('paypal-button-container').innerHTML='';
        paypal.Buttons({
            createOrder: function(data, actions){
                return fetch(API + '/paypal/create-order',{
                    method: 'post',
                    headers:{'Content-Type':'application/json'},
                    body: JSON.stringify({ planId: selectedPlanId })
                }).then(res=>res.json()).then(orderData=>orderData.id);
            },
            onApprove: function(data, actions){
                return fetch(API + '/paypal/capture-order',{
                    method: 'post',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ orderID: data.orderID, usuarioId: currentUserId, planId: selectedPlanId })
                }).then(res=>res.json()).then(details=>{
                    alert('‚úÖ ¬°Licencia renovada!');
                    location.reload();
                });
            }
        }).render('#paypal-button-container');
    }
    // IA chat
    function toggleChat() {
        let win = document.getElementById('chatWindow');
        win.style.display=(win.style.display==='flex')?'none':'flex';
        win.style.flexDirection="column";
    }
    function sendMessage() {
        const input = document.getElementById('chatInput');
        const text = input.value.trim();
        if(!text)return;
        addMessage(text,'user'); input.value='';
        setTimeout(()=>addMessage(obtenerRespuestaIA(text.toLowerCase()),'bot'),500);
    }
    function addMessage(text,type){
        const body = document.getElementById('chatBody'),div=document.createElement('div');
        div.className='msg '+type;div.innerHTML=text;body.appendChild(div);body.scrollTop=body.scrollHeight;
    }
    function obtenerRespuestaIA(txt){
        if(txt.includes('hola')) return "¬°Hola! Soy la IA de GrepoBot. ¬øEn qu√© te ayudo?";
        if(txt.includes('pagar')||txt.includes('paypal')) return "Para pagar, inicia sesi√≥n y selecciona uno de los planes. El pago es autom√°tico.";
        if(txt.includes('instalar')) return "1. Instala Tampermonkey.<br>2. Inicia sesi√≥n.<br>3. Pulsa 'INSTALAR BOT'.";
        if(txt.includes('no funciona')) return "Comprueba que tu licencia est√° activa y recarga la web.";
        if(txt.includes('precio')) return "Planes:<br>- 1 Mes: $7.99<br>- 6 Meses: $45<br>- 1 A√±o: $80";
        return "No te entiendo bien. Prueba con 'pagar', 'instalar' o 'precios'.";
    }
</script>
</body>
</html>
