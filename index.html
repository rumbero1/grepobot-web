<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GrepoBot Web - Panel</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#111827; color:#e5e7eb; margin:0; padding:20px; }
    .container { max-width:1000px; margin:0 auto; }
    header { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
    h1 { margin:0; font-size:20px; color:#7dd3fc; }
    .card { background:#0b1220; border:1px solid #1f2937; padding:16px; border-radius:8px; margin-bottom:12px; }
    button.primary { background:#10b981; color:#fff; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; }
    button.ghost { background:transparent; color:#cbd5e1; border:1px solid #334155; padding:8px 12px; border-radius:6px; cursor:pointer; }
    .gallery img { border-radius:6px; border:1px solid #2b3440; }
    .small { font-size:13px; color:#9ca3af; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .endpoint { font-family:monospace; background:#081026; padding:6px 8px; border-radius:6px; border:1px solid #122033; color:#93c5fd; }
    label { display:block; margin-bottom:6px; color:#cbd5e1; }
    input[type="text"]{ padding:8px;border-radius:6px;border:1px solid #253341;background:#07111a;color:#e6eef8; width:260px;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>GrepoBot Web — Panel de pruebas</h1>
    </header>

    <div class="card">
      <p class="small">Usa este panel para pruebas rápidas: registro/login en el backend, probar soporte y simular la compra si el botón PayPal falla.</p>

      <div style="margin-top:8px;">
        <label>Probar endpoint soporte (GET):</label>
        <div class="row">
          <input id="support-q" type="text" placeholder="Escribe una pregunta (ej: hola)" value="hola">
          <button id="btn-support" class="ghost">Probar /api/support</button>
          <span id="support-res" class="small"></span>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label>Probar create-order (GET):</label>
        <div class="row">
          <button id="btn-create-order" class="ghost">GET /api/paypal/create-order</button>
          <span id="create-res" class="small"></span>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label>Compra simulada (activar licencia en backend)</label>
        <div class="row">
          <button id="btn-buy-sim" class="primary">Comprar (simulado)</button>
          <span class="small">Pulsar pedirá tu usuarioId (nº).</span>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label>Pruebas rápidas (endpoints):</label>
        <div class="small">
          - Registro (POST): <span class="endpoint">/api/registro</span><br>
          - Login (POST): <span class="endpoint">/api/login</span><br>
          - Comprobar licencia (GET): <span class="endpoint">/api/check-license?token=TU_TOKEN</span><br>
          - Descargar script (ejemplo): <span class="endpoint">/api/descargar?usuarioId=ID&amp;variant=tampermonkey-trial&amp;token=TU_TOKEN</span>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Capturas</h3>
      <div class="gallery" style="display:flex;gap:12px;flex-wrap:wrap;">
        <img src="/assets/screenshot1.png" alt="screenshot1" style="max-width:48%;height:auto;">
        <img src="/assets/screenshot2.png" alt="screenshot2" style="max-width:48%;height:auto;">
      </div>
      <p class="small" style="margin-top:8px">Si las imágenes no aparecen, súbelas a la carpeta <strong>assets/</strong> con los nombres <code>screenshot1.png</code> y <code>screenshot2.png</code>.</p>
    </div>

    <footer style="margin-top:18px; text-align:center;" class="small">
      GrepoBot — Panel de pruebas. No se guardan claves en el repositorio.
    </footer>
  </div>

  <script>
    // Soporte GET
    document.getElementById('btn-support').addEventListener('click', async () => {
      const q = document.getElementById('support-q').value || 'hola';
      const el = document.getElementById('support-res');
      el.textContent = '...';
      try {
        const res = await fetch('/api/support?question=' + encodeURIComponent(q));
        const j = await res.json();
        el.textContent = JSON.stringify(j).slice(0, 200);
      } catch (e) {
        el.textContent = 'Error: ' + (e.message || e);
        console.error(e);
      }
    });

    // create-order GET
    document.getElementById('btn-create-order').addEventListener('click', async () => {
      const el = document.getElementById('create-res');
      el.textContent = '...';
      try {
        const res = await fetch('/api/paypal/create-order');
        const j = await res.json();
        el.textContent = JSON.stringify(j);
      } catch (e) {
        el.textContent = 'Error: ' + (e.message || e);
        console.error(e);
      }
    });

    // Comprar simulado (POST capture-order)
    document.getElementById('btn-buy-sim').addEventListener('click', async () => {
      let usuarioId = window.USER_ID || prompt('Introduce tu usuarioId (el número que te dio /api/registro):');
      if (!usuarioId) { alert('UsuarioId requerido'); return; }
      const planId = '1_MES';
      try {
        const res = await fetch('/api/paypal/capture-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ usuarioId, planId })
        });
        const j = await res.json();
        if (j.success) {
          alert('Pago simulado OK. Licencia activada.');
          location.reload();
        } else {
          alert('Error: ' + (j.error || JSON.stringify(j)));
          console.error(j);
        }
      } catch (e) {
        alert('Error al realizar la compra simulada. Revisa la consola.');
        console.error(e);
      }
    });
  </script>
</body>
</html>
