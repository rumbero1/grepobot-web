<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrepoBot Pro - Automatizaci√≥n de √âlite</title>
    <script src="https://www.paypal.com/sdk/js?client-id=ARI8xtvx-zlykSa7RFIka_g5C3_iF8-CaK_ipoT_L9C_mDJiuUyTgTv_HLLHeXNPHrlwRQbmcPmYWIGs&currency=USD"></script>
    <style>
    :root { --primary: #4caf50; --dark: #121212; --dark-card: #1e1e1e; --text: #e0e0e0; --text-muted: #a0a0a0; --gold: #ffd700;}
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--dark); color: var(--text); margin: 0; padding: 0; line-height: 1.6;}
    nav { display: flex; justify-content: space-between; align-items: center; padding: 20px 50px; background: rgba(0,0,0,0.9); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #333;}
    .logo { font-size: 24px; font-weight: bold; color: var(--primary);}
    .nav-links a { color: var(--text); text-decoration: none; margin-left: 20px; font-size: 14px;}
    .btn-login { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 8px 20px; border-radius: 4px; cursor: pointer;}
    .btn-login:hover { background: var(--primary); color: white;}
    .hero { text-align: center; padding: 100px 20px; background: radial-gradient(circle at center, #2a2a2a 0%, #121212 100%);}
    .hero h1 { font-size: 48px; margin-bottom: 10px; color: white;}
    .hero span { color: var(--primary);}
    .hero p { font-size: 18px; color: var(--text-muted); max-width: 600px; margin: 0 auto 40px;}
    .cta-button { background: var(--primary); color: white; padding: 15px 40px; border: none; border-radius: 5px; font-size: 18px; font-weight: bold; cursor: pointer;}
    .cta-button:hover { transform: translateY(-2px);}
    #portal { padding: 80px 20px; max-width: 600px; margin: 0 auto;}
    .login-box { background: var(--dark-card); padding: 40px; border-radius: 10px; border: 1px solid #444;}
    .input-group { margin-bottom: 20px;}
    .input-group label { display: block; margin-bottom: 8px;}
    .input-group input { width: 100%; padding: 12px; background: #2d2d2d; border: 1px solid #444; color: white; border-radius: 4px;}
    .alert { padding: 15px; border-radius: 4px; margin-top: 20px; font-size: 14px; display: none; text-align: center;}
    .alert.error { background: rgba(255, 82, 82, 0.1); color: #ff5252; border: 1px solid #ff5252;}
    .alert.success { background: rgba(76, 175, 80, 0.1); color: #4caf50; border: 1px solid #4caf50;}
    #dashboard { display: none;}
    .premium-box { background: #1a1a1a; padding: 25px; border: 1px solid #333; border-radius: 10px; margin-top: 30px;}
    .plans-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px;}
    .plan-card { background: #252525; border: 2px solid #444; border-radius: 10px; padding: 15px; width: 30%; min-width: 120px; cursor: pointer;}
    .plan-card:hover { border-color: var(--gold);}
    .plan-card.selected { border-color: var(--gold); background: #2a2a1a;}
    .plan-name, .plan-price { display: block;}
    .plan-price { color: var(--gold);}
    .plan-save { font-size: 11px; color: #4caf50;}
    footer { text-align: center; padding: 40px; color: var(--text-muted); font-size: 12px; border-top: 1px solid #333;}
    </style>
</head>
<body>
<nav>
    <div class="logo">‚öîÔ∏è GrepoBot Pro</div>
    <div class="nav-links">
        <a href="#guide">Manual</a>
        <a href="#portal">Precios</a>
        <button class="btn-login" onclick="scrollToPortal()">Area Clientes</button>
    </div>
</nav>
<section class="hero">
    <h1>Domina el Mundo, <span>Autom√°ticamente</span></h1>
    <p>El bot m√°s avanzado para Grepolis. Indetectable y con Soporte IA incluido.</p>
    <button class="cta-button" onclick="scrollToPortal()">PRUEBA DE 7 D√çAS</button>
</section>
<section id="portal">
    <div class="login-box">
        <h2 style="text-align:center; margin-bottom:30px;">Acceso al Portal</h2>
        <div id="login-form">
            <div class="input-group"><label>Usuario</label>
                <input type="text" id="user" placeholder="Tu nombre de usuario"></div>
            <div class="input-group"><label>Contrase√±a</label>
                <input type="password" id="pass" placeholder="Tu contrase√±a"></div>
            <button class="cta-button" style="width:100%; font-size:16px;" onclick="acceder()">ENTRAR / REGISTRARSE</button>
            <div id="msg-login" class="alert"></div>
        </div>
        <div id="dashboard">
            <h3 style="text-align:center; color:#4caf50;">Hola, <span id="user-display"></span></h3>
            <div id="status-licencia" class="alert success" style="display:block; margin-bottom:20px;">Cargando...</div>
            <div style="background:#222; padding:15px; border-radius:5px; margin-bottom:20px; text-align:center;">
                <h4>1. Instalaci√≥n</h4>
                <p style="font-size:12px; color:#aaa;">Instalar script en Tampermonkey</p>
                <button class="cta-button" id="btn-descargar" style="width:100%; background:#2196F3;" onclick="descargarArchivo()">üì• INSTALAR BOT</button>
                <div id="msg-descarga" style="margin-top:10px; font-size:12px;"></div>
            </div>
            <div class="premium-box">
                <h3 style="text-align:center; color:var(--gold);">üíé Renovar Licencia</h3>
                <p style="text-align:center; color:#aaa; margin-bottom:20px;">Elige tu plan:</p>
                <div class="plans-container">
                    <div class="plan-card selected" onclick="selectPlan('1_MES', this)">
                        <span class="plan-name">1 Mes</span>
                        <span class="plan-price">$7.99</span>
                    </div>
                    <div class="plan-card" onclick="selectPlan('6_MESES', this)">
                        <span class="plan-name">6 Meses</span>
                        <span class="plan-price">$45.00</span>
                        <span class="plan-save">Ahorra 10%</span>
                    </div>
                    <div class="plan-card" onclick="selectPlan('12_MESES', this)">
                        <span class="plan-name">1 A√±o</span>
                        <span class="plan-price">$80.00</span>
                        <span class="plan-save">Ahorra 20%</span>
                    </div>
                </div>
                <div id="paypal-button-container"></div>
            </div>
        </div>
    </div>
</section>
<footer>
    <p>¬© 2026 GrepoBot Team. Software educativo.</p>
</footer>

<script>
    // --- CONFIGURACI√ìN API ---
    const API = 'https://grepobot-web.onrender.com/api';

    let currentUserId = null;
    let selectedPlanId = '1_MES';

    function scrollToPortal() { document.getElementById('portal').scrollIntoView({behavior: 'smooth'}); }

    function selectPlan(planId, element) {
        selectedPlanId = planId;
        document.querySelectorAll('.plan-card').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        document.getElementById('paypal-button-container').innerHTML = '';
        renderPayPalButtons();
    }

    async function acceder() {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;
        const msg = document.getElementById('msg-login');
        
        if(!u || !p) { msg.textContent="Faltan datos"; msg.className = "alert error"; msg.style.display='block'; return; }

        let res = await fetch(API + '/login', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:u, password:p}) });
        let data = await res.json();

        if(!data.success) {
            if(confirm("Usuario no encontrado. ¬øRegistrar nueva cuenta?")) {
                res = await fetch(API + '/registro', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:u, password:p}) });
                data = await res.json();
            } else return;
        }

        if(data.success) {
            currentUserId = data.usuarioId;
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('user-display').textContent = data.username || u;
            
            const statusDiv = document.getElementById('status-licencia');
            if(data.dias <= 0) {
                statusDiv.className = "alert error";
                statusDiv.innerHTML = `‚õî <b>LICENCIA CADUCADA</b><br>Renueva abajo para continuar.`;
            } else {
                statusDiv.className = "alert success";
                statusDiv.innerHTML = `‚úÖ <b>Licencia Activa</b> (${data.dias} d√≠as restantes)`;
            }
            const btnDescargar = document.getElementById('btn-descargar');
            if (data.yaDescargo) {
                btnDescargar.disabled = true;
                btnDescargar.style.opacity = '0.5';
                btnDescargar.style.cursor = 'not-allowed';
                document.getElementById('msg-descarga').innerHTML = '<span style="color:#ff5252;">‚ùå Ya descargaste el bot. No puedes descargar de nuevo hasta renovar la licencia.</span>';
            } else {
                document.getElementById('msg-descarga').innerHTML = '<span style="color:#4caf50;">‚úÖ Descarga disponible (una sola vez)</span>';
            }
            renderPayPalButtons();
        } else {
            msg.textContent = data.error || "Error en el login"; 
            msg.className = "alert error"; 
            msg.style.display = 'block';
        }
    }

    function descargarArchivo() {
        if(!currentUserId) return alert("Sesi√≥n expirada");
        const scriptUrl = API + '/descargar/' + currentUserId + '/GrepoBot.user.js';
        window.open(scriptUrl, "_blank"); // ¬°Obligatorio abrir en pesta√±a nueva!
    }

    function renderPayPalButtons() {
        document.getElementById('paypal-button-container').innerHTML = '';
        paypal.Buttons({
            createOrder: function(data, actions) {
                return fetch(API + '/paypal/create-order', {
                    method: 'post',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ planId: selectedPlanId })
                }).then(res => res.json()).then(orderData => orderData.id);
            },
            onApprove: function(data, actions) {
                return fetch(API + '/paypal/capture-order', {
                    method: 'post',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ orderID: data.orderID, usuarioId: currentUserId, planId: selectedPlanId })
                }).then(res => res.json()).then(details => {
                    alert('‚úÖ ¬°PAGO COMPLETADO! Licencia renovada.');
                    location.reload();
                });
            }
        }).render('#paypal-button-container');
    }

</script>
